---
apiVersion: v1
kind: ConfigMap
metadata:
  name: operator-environment-config
  namespace: redis-enterprise
  labels:
    app: redis-enterprise
data:
  # ============================================================================
  # VAULT CONFIGURATION - IN-CLUSTER
  # ============================================================================
  # Vault rodando dentro do Kubernetes no namespace 'vault'
  # Usa DNS interno: vault.vault.svc.cluster.local
  
  # URL do Vault (DNS interno do Kubernetes)
  VAULT_SERVER_FQDN: "vault.vault.svc.cluster.local"
  
  # Porta do Vault (padrão 8200)
  VAULT_SERVER_PORT: "8200"
  
  # Protocolo (sempre HTTPS)
  VAULT_SERVER_PROTOCOL: "https"
  
  # ============================================================================
  # VAULT AGENT INJECTOR
  # ============================================================================
  # Habilita injeção automática de secrets via Vault Agent
  VAULT_AGENT_INJECTOR_ENABLED: "true"
  
  # ============================================================================
  # KUBERNETES AUTH
  # ============================================================================
  # Path do Kubernetes auth method no Vault
  VAULT_AUTH_PATH: "kubernetes"
  
  # Role para o Operator
  VAULT_OPERATOR_ROLE: "redis-enterprise-operator-redis-enterprise"
  
  # Role para o REC
  VAULT_REC_ROLE: "redis-enterprise-rec-redis-enterprise"
  
  # ============================================================================
  # SECRETS PATH
  # ============================================================================
  # Path base dos secrets no Vault (KV v2)
  # Formato: secret/data/<namespace>/<secret-name>
  VAULT_SECRET_PATH: "secret/data/redisenterprise-redis-enterprise"
  
  # ============================================================================
  # TLS/CA CERTIFICATE
  # ============================================================================
  # Para Vault in-cluster, o CA é gerenciado automaticamente pelo Kubernetes
  # O Vault Agent Injector injeta o CA automaticamente
  # Não é necessário configurar VAULT_CA_CERT manualmente
  
  # ============================================================================
  # ADMISSION WEBHOOK TLS
  # ============================================================================
  # Nome do secret no Vault que contém o certificado do admission webhook
  ADMISSION_TLS_SECRET_NAME: "admission-tls"
  
  # ============================================================================
  # LOGGING
  # ============================================================================
  # Nível de log (debug, info, warn, error)
  LOG_LEVEL: "info"
  
  # ============================================================================
  # OBSERVAÇÕES
  # ============================================================================
  # 1. O Vault Agent Injector adiciona automaticamente:
  #    - Sidecar vault-agent nos pods do REC
  #    - Init container vault-agent-init
  #    - Volume /vault/secrets com os secrets
  #
  # 2. O Operator busca os seguintes secrets no Vault:
  #    - admission-tls: Certificado do admission webhook
  #    - rec: Credenciais do cluster (username/password)
  #
  # 3. Paths completos no Vault:
  #    - secret/data/redisenterprise-redis-enterprise/admission-tls
  #    - secret/data/redisenterprise-redis-enterprise/rec
  #
  # 4. O Vault Agent renova automaticamente o token antes de expirar
  #
  # 5. Diferenças vs Vault Externo:
  #    - VAULT_SERVER_FQDN usa DNS interno (não IP público)
  #    - Não precisa configurar Security Groups
  #    - CA certificate é gerenciado automaticamente
  #    - Latência muito menor (rede interna)

