# Operator Environment Configuration for Vault Integration
#
# This ConfigMap configures the Redis Enterprise operator to use HashiCorp Vault
# for secret management instead of Kubernetes secrets.
#
# Prerequisites:
# - Vault server configured with Kubernetes auth method
# - Vault policies and roles created
# - vault-ca-cert secret created
#
# Instructions:
# 1. Update VAULT_SERVER_FQDN with your Vault server IP or hostname
# 2. Apply this ConfigMap BEFORE installing the Redis Enterprise operator
# 3. Install operator with: --set extraEnvFrom[0].configMapRef.name=operator-environment-config
#
# Verification:
#   kubectl get configmap operator-environment-config -n redis-enterprise
#   kubectl describe configmap operator-environment-config -n redis-enterprise

apiVersion: v1
kind: ConfigMap
metadata:
  name: operator-environment-config
  namespace: redis-enterprise
data:
  # Enable Vault integration (required)
  CREDENTIAL_TYPE: "vault"
  
  # Vault server connection (REQUIRED - update with your Vault server)
  VAULT_SERVER_FQDN: "<VAULT_SERVER_IP_OR_FQDN>"
  VAULT_SERVICE_PORT_HTTPS: "8200"
  
  # Vault secret engine configuration
  VAULT_SECRET_ROOT: "secret"
  VAULT_SECRET_PREFIX: "redisenterprise-redis-enterprise"
  
  # Vault authentication
  VAULT_ROLE: "redis-enterprise-operator-redis-enterprise"
  VAULT_AUTH_PATH: "kubernetes"
  
  # Vault Enterprise namespace (leave empty for Community Edition)
  # For Vault Enterprise, set to your Vault namespace (e.g., "admin")
  VAULT_NAMESPACE: ""
  
  # Secret cache expiration (seconds)
  # Minimum recommended: 120 seconds
  VAULT_CACHE_SECRET_EXPIRATION_SECONDS: "120"

---
# Configuration Parameters Explained:
#
# CREDENTIAL_TYPE:
#   Must be "vault" to enable Vault integration
#
# VAULT_SERVER_FQDN:
#   Hostname or IP address of your Vault server
#   Examples:
#     - "10.0.1.100" (private IP in same VPC)
#     - "vault.example.com" (DNS name)
#     - "vault.vault.svc.cluster.local" (if Vault runs in K8s)
#
# VAULT_SERVICE_PORT_HTTPS:
#   Vault HTTPS port (default: 8200)
#
# VAULT_SECRET_ROOT:
#   KV v2 secret engine mount path (default: "secret")
#
# VAULT_SECRET_PREFIX:
#   Prefix for all Redis Enterprise secrets
#   Format: redisenterprise-<NAMESPACE>
#   Default: "redisenterprise-redis-enterprise"
#
# VAULT_ROLE:
#   Vault role name for operator authentication
#   Must match the role created in Vault
#   Format: redis-enterprise-operator-<NAMESPACE>
#
# VAULT_AUTH_PATH:
#   Kubernetes auth method path in Vault (default: "kubernetes")
#
# VAULT_NAMESPACE:
#   Vault Enterprise namespace (empty for Community Edition)
#
# VAULT_CACHE_SECRET_EXPIRATION_SECONDS:
#   How long to cache secrets locally (default: 120)
#   Minimum recommended: 120 seconds
#
# Secret Path Structure:
#   Secrets are stored at: <VAULT_SECRET_ROOT>/data/<VAULT_SECRET_PREFIX>/<secret-name>
#   Example: secret/data/redisenterprise-redis-enterprise/rec

