# ============================================================================
# RedisInsight - Gateway API HTTPRoute
# ============================================================================
#
# Exposes RedisInsight via Kubernetes Gateway API with TLS.
#
# Prerequisites:
# - Gateway API CRDs installed
# - Gateway controller installed (e.g., NGINX Gateway Fabric)
# - Gateway resource created
# - cert-manager installed (for automatic TLS)
#
# Access: https://redisinsight.example.com
# ============================================================================

---
# Certificate for TLS
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: redisinsight-cert
  namespace: redis-enterprise
spec:
  secretName: redisinsight-tls
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  dnsNames:
    - redisinsight.example.com

---
# HTTPRoute for RedisInsight
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: redisinsight
  namespace: redis-enterprise
  labels:
    app: redisinsight
spec:
  parentRefs:
    - name: redis-gateway
      namespace: nginx-gateway
      sectionName: https
  
  hostnames:
    - "redisinsight.example.com"
  
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: redisinsight-service
          port: 80

